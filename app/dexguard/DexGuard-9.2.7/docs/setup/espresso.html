



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the DexGuard tool">
      
      
      
        <meta name="author" content="Guardsquare">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.3">
    
    
      
        <title>Espresso - DexGuard</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=:300,400,400i,700%7C&display=fallback">
        <style>body,input{font-family:"","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
      <link rel="stylesheet" href="../css/extra2.css">
    
      <link rel="stylesheet" href="../css/tabs.css">
    
    
      
    
    
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NMXSB9');</script>
<!-- End Google Tag Manager -->


  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#build-your-application" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NMXSB9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
   
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="DexGuard" aria-label="DexGuard" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../img/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              DexGuard
            </span>
            <span class="md-header-nav__topic">
              
                Espresso
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    

    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="DexGuard" class="md-nav__button md-logo">
      
        <img alt="logo" src="../img/logo.png" width="48" height="48">
      
    </a>
    DexGuard
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../quickstart.html" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../introduction.html" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="standalone.html" title="DexGuard" class="md-nav__link">
      DexGuard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="upgrading.html" title="Upgrading" class="md-nav__link">
      Upgrading
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="gradle-plugin.html" title="Gradle Plugin" class="md-nav__link">
      Gradle Plugin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="repository.html" title="Maven repository" class="md-nav__link">
      Maven repository
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Espresso
      </label>
    
    <a href="espresso.html" title="Espresso" class="md-nav__link md-nav__link--active">
      Espresso
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#build-your-application" class="md-nav__link">
    Build your application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-test-application" class="md-nav__link">
    Build the test application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process-your-application-with-dexguard-and-print-out-the-mapping-file" class="md-nav__link">
    Process your application with DexGuard and print out the mapping file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process-the-test-application-using-dexguard-and-the-espresso-configuration" class="md-nav__link">
    Process the test application using DexGuard and the Espresso configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-both-applications-to-a-test-device-or-emulator" class="md-nav__link">
    Install both applications to a test device or emulator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execute-the-espresso-tests" class="md-nav__link">
    Execute the Espresso tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uninstall-the-applications" class="md-nav__link">
    Uninstall the applications
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    Best practices
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-code" class="md-nav__link">
    Test code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    Dependencies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-configurations" class="md-nav__link">
    Default configurations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dexguard-espressopro" class="md-nav__link">
    dexguard-espresso.pro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dexguard-espresso-no-resource-optimizationspro" class="md-nav__link">
    dexguard-espresso-no-resource-optimizations.pro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dexguard-espresso-aggressive-optimizationspro" class="md-nav__link">
    dexguard-espresso-aggressive-optimizations.pro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dexguard-espresso-safe-optimizationspro" class="md-nav__link">
    dexguard-espresso-safe-optimizations.pro
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="cordovaplugin.html" title="Cordova Plugin" class="md-nav__link">
      Cordova Plugin
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Configuration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../configuration.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../usage.html" title="Reference Guide" class="md-nav__link">
      Reference Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../defaultconfigurations.html" title="Default Configs" class="md-nav__link">
      Default Configs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../annotations.html" title="Annotations" class="md-nav__link">
      Annotations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Features
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Features
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../protection.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rasp.html" title="RASP" class="md-nav__link">
      RASP
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Languages & Platforms
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Languages & Platforms
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../java.html" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin.html" title="Kotlin" class="md-nav__link">
      Kotlin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../javascript.html" title="JavaScript" class="md-nav__link">
      JavaScript
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      ThreatCast
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        ThreatCast
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../threatcast.html" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      In Depth
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        In Depth
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../protectionreport.html" title="Protection Report" class="md-nav__link">
      Protection Report
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples.html" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../refcard.html" title="Reference Card" class="md-nav__link">
      Reference Card
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../optimizations.html" title="Optimizations" class="md-nav__link">
      Optimizations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../attributes.html" title="Attributes" class="md-nav__link">
      Attributes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../loggingremoval.html" title="Logging Removal" class="md-nav__link">
      Logging Removal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../verification.html" title="Verification" class="md-nav__link">
      Verification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../runtime.html" title="Runtime Library" class="md-nav__link">
      Runtime Library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../plugins.html" title="Encryption Plugins" class="md-nav__link">
      Encryption Plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../codepush.html" title="Code Push" class="md-nav__link">
      Code Push
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Addons
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Addons
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../addons_overview.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ndk.html" title="NDK" class="md-nav__link">
      NDK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../whitebox.html" title="Whitebox Cryptography" class="md-nav__link">
      Whitebox Cryptography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fingerprinting.html" title="Device Fingerprinting" class="md-nav__link">
      Device Fingerprinting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../securekeyboard.html" title="Secure Keyboard" class="md-nav__link">
      Secure Keyboard
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/androidstudio.html" title="Android Studio Plugin" class="md-nav__link">
      Android Studio Plugin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/libraryrulesgenerator.html" title="Library Rules Generator" class="md-nav__link">
      Library Rules Generator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/retrace.html" title="ReTrace" class="md-nav__link">
      ReTrace
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Troubleshooting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Troubleshooting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../troubleshooting.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reportingissues.html" title="Reporting Issues" class="md-nav__link">
      Reporting Issues
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../releasenotes.html" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../license.html" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#build-your-application" class="md-nav__link">
    Build your application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-test-application" class="md-nav__link">
    Build the test application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process-your-application-with-dexguard-and-print-out-the-mapping-file" class="md-nav__link">
    Process your application with DexGuard and print out the mapping file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process-the-test-application-using-dexguard-and-the-espresso-configuration" class="md-nav__link">
    Process the test application using DexGuard and the Espresso configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-both-applications-to-a-test-device-or-emulator" class="md-nav__link">
    Install both applications to a test device or emulator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execute-the-espresso-tests" class="md-nav__link">
    Execute the Espresso tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uninstall-the-applications" class="md-nav__link">
    Uninstall the applications
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    Best practices
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-code" class="md-nav__link">
    Test code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    Dependencies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-configurations" class="md-nav__link">
    Default configurations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dexguard-espressopro" class="md-nav__link">
    dexguard-espresso.pro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dexguard-espresso-no-resource-optimizationspro" class="md-nav__link">
    dexguard-espresso-no-resource-optimizations.pro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dexguard-espresso-aggressive-optimizationspro" class="md-nav__link">
    dexguard-espresso-aggressive-optimizations.pro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dexguard-espresso-safe-optimizationspro" class="md-nav__link">
    dexguard-espresso-safe-optimizations.pro
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Espresso</h1>
                
                <p>Automated testing is a very useful tool to verify your application works as
expected. As the hardening that DexGuard applies can change the structure of
your code you may want to use these automated tests to verify everything still
works as it should. Espresso is a testing framework that can do just that, it
is provided by Google and can easily be configured in your Gradle project. </p>
<p>A test build for an unprocessed application doesn't always work with its
processed version. For this reason the test has to be processed by DexGuard
using a specific configuration.</p>
<p>When using the <a href="gradle-plugin.html">DexGuard Gradle plugin</a> no additional action
is required, the test will automatically be processed using the aforementioned
configuration. However, you will have to prevent <a href="../troubleshooting.html#preserveruntimeinvisibleannotations">D8/R8 from stripping Espresso
annotations</a>,
<a href="#install-both-applications-to-a-test-device-or-emulator">install</a> and
<a href="#execute-the-espresso-tests">run</a> the tests manually.</p>
<p>When executing DexGuard outside of the build process you will have to perform
the following actions:</p>
<ol>
<li>Build your application.</li>
<li>Build the test application.</li>
<li>Process your application using DexGuard and print out the mapping file.</li>
<li>Process the test application using DexGuard and the Espresso conifguration.</li>
<li>Install both applications to a test device or emulator.</li>
<li>Execute the Espresso tests.</li>
</ol>
<h3 id="build-your-application">Build your application<a class="headerlink" href="#build-your-application" title="Permanent link">&para;</a></h3>
<p>You can build your application using the <code>assemble</code> Gradle task. This task will
build all variants of your application, if you only want to build a single
variant, append the name of the variant to the end. For example, <code>assembleRelease</code> to build only the release variant.</p>
<div class="tabbed-set" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">Linux/macOS</label><div class="tabbed-content">
<div class="codehilite"><pre><span></span><code>./gradlew assembleRelease
</code></pre></div>

</div>
<input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><label for="__tabbed_1_2">Windows</label><div class="tabbed-content">
<div class="codehilite"><pre><span></span><code>gradlew assembleRelease
</code></pre></div>

</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you use Espresso annotations, you will have to make sure they are not
stripped by D8/R8 while building your application. DexGuard
cannot see the annotations otherwise, which may result in exceptions at runtime.
Please visit <strong><a href="../troubleshooting.html#preserveruntimeinvisibleannotations">this page</a></strong> 
for more information.</p>
</div>
<h3 id="build-the-test-application">Build the test application<a class="headerlink" href="#build-the-test-application" title="Permanent link">&para;</a></h3>
<p>The test application is a special test variant derived from the one you want to
test. As such, you can build it like any other variant of your application. The
name of this test variant is the name of the base variant appended with
<code>androidTest</code>. For example, <code>releaseAndroidTest</code> for the release variant.</p>
<p>This test variant will build an application containing your Espresso tests, it
will be installed alongside your actual application. Upon opening this test
application it will open up the application it's supposed to test and performs
the actions described in the tests, reporting the results.</p>
<p>Building this test variant is done by calling its <code>assemble</code> task. If you are
testing your debug build this would look something like this:</p>
<div class="tabbed-set" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><label for="__tabbed_2_1">Linux/macOS</label><div class="tabbed-content">
<div class="codehilite"><pre><span></span><code>./gradlew assembleDebugAndroidTest
</code></pre></div>

</div>
<input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><label for="__tabbed_2_2">Windows</label><div class="tabbed-content">
<div class="codehilite"><pre><span></span><code>gradlew assembleDebugAndroidTest
</code></pre></div>

</div>
</div>
<p>The resulting apk can be found in the <code>build/outputs/androidTest</code> directory.</p>
<h3 id="process-your-application-with-dexguard-and-print-out-the-mapping-file">Process your application with DexGuard and print out the mapping file<a class="headerlink" href="#process-your-application-with-dexguard-and-print-out-the-mapping-file" title="Permanent link">&para;</a></h3>
<p>In this step you process your application as you normally would as described
earlier on this page. When you want to test the resulting apk using Espresso
you need to keep two things in mind, however.</p>
<ul>
<li>You need to print out the mapping file. This file will be used when
  processing the test application to rename the calls in this application to
  the obfuscated name.</li>
<li>You need to sign it so it can be installed on the test device or emulator.
  Signing it with the default debug keystore works perfectly fine.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nb">-printmapping </span><span class="err">mapping.txt</span>

<span class="nb">-keystore </span><span class="err">&lt;user.home&gt;/.android/debug.keystore</span>
<span class="nb">-keystorepassword</span> <span class="kt">android</span>
<span class="nb">-keyalias</span> <span class="kt">androiddebugkey</span>
<span class="nb">-keypassword</span> <span class="kt">android</span>
</code></pre></div>

<h3 id="process-the-test-application-using-dexguard-and-the-espresso-configuration">Process the test application using DexGuard and the Espresso configuration<a class="headerlink" href="#process-the-test-application-using-dexguard-and-the-espresso-configuration" title="Permanent link">&para;</a></h3>
<p>Processing the test application is straight-forward and will require no
custom configuration in almost all cases. The configuration is similar to that
of a normal application except for the default configuration and some
additional requirements.</p>
<p>The default configuration used is <code>dexguard-espresso-internal.pro</code>. This
will configure DexGuard to perform some adaptations to match the
application under test. Apart from that, minimal processing is performed to
prevent any major structural changes to your test code.</p>
<p>The additional requirements are the following:</p>
<ul>
<li>The unobfuscated main application has to be passed in as a library jar to
  DexGuard since the test application depends on it.</li>
<li>An <a href="../usage.html#applymapping"><code>-applymapping</code></a> rule has to be added using the
  mapping file of the main application so calls into the main application code
  can be renamed consistently.</li>
<li>The apk needs to be signed so it can be installed. The Android build chain
  will use the default debug keystore, so we suggest doing the same.</li>
</ul>
<p>Example:
<div class="codehilite"><pre><span></span><code><span class="nb">-injars </span><span class="err">path/to/my-application-androidTest.apk</span>

<span class="nb">-outjars </span><span class="err">path/to/obfuscated-application-androidTest.apk</span>

<span class="nb">-libraryjars </span><span class="err">path/to/my-application.apk</span>
<span class="nb">-libraryjars </span><span class="err">/path/to/android/sdk/platforms/android-XX/android.jar</span>

<span class="nb">-include </span><span class="err">/lib/dexguard-espresso-internal.pro</span>

<span class="nb">-applymapping </span><span class="err">path/to/mapping.txt</span>

<span class="nb">-keystore </span><span class="err">&lt;user.home&gt;/.android/debug.keystore</span>
<span class="nb">-keystorepassword</span> <span class="kt">android</span>
<span class="nb">-keyalias</span> <span class="kt">androiddebugkey</span>
<span class="nb">-keypassword</span> <span class="kt">android</span>
</code></pre></div></p>
<h3 id="install-both-applications-to-a-test-device-or-emulator">Install both applications to a test device or emulator<a class="headerlink" href="#install-both-applications-to-a-test-device-or-emulator" title="Permanent link">&para;</a></h3>
<p>Installing a local apk to a connected device or emulator can easily be done
using <code>adb</code>, which comes with the Android SDK:</p>
<div class="tabbed-set" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><label for="__tabbed_3_1">Linux/macOS</label><div class="tabbed-content">
<div class="codehilite"><pre><span></span><code>path/to/android/sdk/platform-tools/adb install path/to/obfuscated-application.apk
path/to/android/sdk/platform-tools/adb install path/to/obfuscated-application-androidTest.apk
</code></pre></div>

</div>
<input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><label for="__tabbed_3_2">Windows</label><div class="tabbed-content">
<div class="codehilite"><pre><span></span><code><span class="k">path</span>\to\android\sdk\platform-tools\adb install path\to\obfuscated-application.apk
<span class="k">path</span>\to\android\sdk\platform-tools\adb install path\to\obfuscated-application-androidTest.apk
</code></pre></div>

</div>
</div>
<h3 id="execute-the-espresso-tests">Execute the Espresso tests<a class="headerlink" href="#execute-the-espresso-tests" title="Permanent link">&para;</a></h3>
<p>Executing the Espresso tests call also be done via <code>adb</code>:</p>
<div class="tabbed-set" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><label for="__tabbed_4_1">Linux/macOS</label><div class="tabbed-content">
<div class="codehilite"><pre><span></span><code>path/to/android/sdk/platform-tools/adb shell am instrument -w my.package.name.test/android.support.test.runner.AndroidJUnitRunner
</code></pre></div>

</div>
<input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><label for="__tabbed_4_2">Windows</label><div class="tabbed-content">
<div class="codehilite"><pre><span></span><code><span class="k">path</span>\to\android\sdk\platform-tools\adb shell am instrument -w my.package.name.test/android.support.test.runner.AndroidJUnitRunner
</code></pre></div>

</div>
</div>
<p>The <code>-w</code> argument makes it so the process waits to return until it's finished,
this is <strong>required</strong> for test runners. The following argument is the test
runner, starting with the <strong>package name</strong> (or <strong>application ID</strong>) of the
<strong>test application</strong>. This is by default the package name of the main
application appended with <code>.test</code>. After that is a <code>/</code> followed by
<strong>fully qualified class name</strong> of the <strong>test runner</strong> to use to run the tests.
This is by default the <code>android.support.test.runner.AndroidJUnitRunner</code>, but if
you can also use a custom one.</p>
<p>For more information on this process, refer to the
<a href="https://developer.android.com/studio/test/command-line#RunTestsDevice">official documentation</a>.</p>
<h3 id="uninstall-the-applications">Uninstall the applications<a class="headerlink" href="#uninstall-the-applications" title="Permanent link">&para;</a></h3>
<p>This step is optional, but if you want to uninstall the applications when you
are done with the tests, you can again use <code>adb</code> for this purpose:</p>
<div class="tabbed-set" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><label for="__tabbed_5_1">Linux/macOS</label><div class="tabbed-content">
<div class="codehilite"><pre><span></span><code>path/to/android/sdk/platform-tools/adb uninstall my.package.name
path/to/android/sdk/platform-tools/adb uninstall my.package.name.test
</code></pre></div>

</div>
<input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><label for="__tabbed_5_2">Windows</label><div class="tabbed-content">
<div class="codehilite"><pre><span></span><code><span class="k">path</span>\to\android\sdk\platform-tools\adb uninstall my.package.name
<span class="k">path</span>\to\android\sdk\platform-tools\adb uninstall my.package.name.test
</code></pre></div>

</div>
</div>
<p>As you can see, the <code>uninstall</code> command takes in the package name of the
application you want to uninstall.</p>
<h2 id="best-practices">Best practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<p>Even though DexGuard does not alter the functionality and intended behavior of
your application, it does change the internal structure quite a bit due to the
optimizations and layers of protection it applies. This means some care should
be taken when creating your Espresso tests. This section will go over our
recommendations to lower the amount of additional configuration needed and keep
the obfuscation of the application you are testing as close to the final
product as possible.</p>
<p>The general idea is to start from working tests without applying DexGuard to
your application. After that, try to run the tests with DexGuard applied but
without any additional configuration. If they do not succeed, it means DexGuard
broke them and you'll either have to rework your test code to be less dependent
on the application code or extend the configuration for the application under
test.</p>
<div class="admonition warning">
<p class="admonition-title">Test configuration</p>
<p>Many of the suggestions below will mention adding additional configuration
for the application that's being tested. These additional rules and default
configurations should <strong>only</strong> be applied when testing your app using
Espresso, they <strong>should not</strong> be applied when creating the application
you're going to ship since they <strong>weaken</strong> the obfuscation to allow the
tests to do their work.</p>
</div>
<h3 id="test-code">Test code<a class="headerlink" href="#test-code" title="Permanent link">&para;</a></h3>
<p>Espresso is a framework that allows you to emulate user input and verify the
current state of the user interface. This means it's actually very forgiving
with regards to the various optimization and obfuscation techniques DexGuard
applies. There are some problematic cases, of course.</p>
<p><strong>Using classes from the application in your tests should be avoided as much as possible.</strong>
As stated earlier, DexGuard will apply optimizations and obfuscations that can
drastically change the way your code looks internally. Our default
configuration for the Espresso tests makes the obfuscation less of an issue but
it's not perfect and the optimizations will almost certainly cause problems.</p>
<p>We are aware that this is not always possible and there are ways around this.
This is generally not ideal, as you want to avoid additional configuration. For
this reason we do stress that you try to avoid this as much as you can.</p>
<p>Possible solutions include:</p>
<ul>
<li>Copy the class or method you want to use. This is really only advised if they
  are small and not likely to change.</li>
<li>Create dedicated methods used in tests only. These methods are guaranteed to
  be removed by DexGuard in your actual release and can be kept using the rule
  below.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nb">-keepclassmembers</span><span class="w"> </span><span class="kd">class </span><span class="nc">classname</span>
<span class="p">{</span>
    <span class="kt">returntype</span> <span class="nf">methodname</span><span class="p">(</span><span class="kt">parametertypes</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Add additional rules to keep any relevant code or disable any problematic
  optimizations. You can read more about the various optimizations that can be
  disabled on the <a href="../optimizations.html">optimizations</a> page.</li>
<li>Use a <a href="#default-configurations">default test configuration</a>. Depending on the
  configuration you choose, several classes will be kept and/or optimizations
  will be disabled. If the problem persists you'll likely have to add a custom
  keep rule.</li>
</ul>
<h3 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h3>
<p>DexGuard also processes the various resources that are used in your
application, which means this can cause problems if you try to refer to them
from your test code. Just as with code,
<strong>try to avoid referring to application resources in your test code</strong>.</p>
<p>If this is not possible, try running your tests to see if there are any issues.
If there are, you can try any of the following suggestions:</p>
<ul>
<li>Use the
  <a href="#dexguard-espresso-no-resource-optimizationspro"><code>dexguard-espresso-no-resource-optimizations.pro</code></a>
  default test configuration.</li>
<li>Keep the problematic resources using the
  <a href="../usage.html#keepresources"><code>-keepresources</code></a> rule.</li>
</ul>
<h3 id="dependencies">Dependencies<a class="headerlink" href="#dependencies" title="Permanent link">&para;</a></h3>
<p>When building the tests the Android gradle plugin will treat the dependencies
shared by the application and its tests as compile only dependencies, meaning
they won't end up packaged in the test application. This saves space and in
normal circumstances isn't an issue as the dependencies will be available in
the application under test.</p>
<p>However, when using DexGuard this no longer holds true because of its
shrinking. If the application does not use a class that the tests do use, it
will be removed during the shrinking step from the main application. Here are
some suggestions to resolve these issues if they occur:</p>
<ul>
<li>Try to avoid sharing dependencies between your application and its tests. In
  general this shouldn't be too much of an issue, but there are some common
  cases where this is not possible.</li>
<li>Add keep rules for the missing classes.</li>
</ul>
<h2 id="default-configurations">Default configurations<a class="headerlink" href="#default-configurations" title="Permanent link">&para;</a></h2>
<p>DexGuard provides a few default configurations you can include for applicaton
builds you're going to test using Espresso. These configurations have a
specific purpose and are <strong>independent</strong> of each other, meaning you can use
multiple at the same time. The available default configurations are explained
in more detail below.</p>
<h3 id="dexguard-espressopro"><code>dexguard-espresso.pro</code><a class="headerlink" href="#dexguard-espressopro" title="Permanent link">&para;</a></h3>
<p>This is the basic configuration needed to run Espresso tests on an application
that is obfuscated by DexGuard. It also offers support for the
<code>@VisibleForTesting</code> annotation which will prevent annotated classes or members
from being obfuscated, shrunk or optimized in order to be accessed by tests.</p>
<div class="codehilite"><pre><span></span><code><span class="nb">-include </span><span class="err">/lib/dexguard-espresso.pro</span>
</code></pre></div>

<h3 id="dexguard-espresso-no-resource-optimizationspro"><code>dexguard-espresso-no-resource-optimizations.pro</code><a class="headerlink" href="#dexguard-espresso-no-resource-optimizationspro" title="Permanent link">&para;</a></h3>
<p>Using this default configuration makes using resources in your test code a
non-issue. It disables all resource related optimizations so everything your
tests expect to find should still be there with their original ids.</p>
<div class="codehilite"><pre><span></span><code><span class="nb">-include </span><span class="err">/lib/dexguard-espresso-no-resource-optimizations.pro</span>
</code></pre></div>

<h3 id="dexguard-espresso-aggressive-optimizationspro"><code>dexguard-espresso-aggressive-optimizations.pro</code><a class="headerlink" href="#dexguard-espresso-aggressive-optimizationspro" title="Permanent link">&para;</a></h3>
<p>This default configuration disables all less invasive code optimizations. These
should be sufficient when your tests only access a small portion of the
application code. The optimizations that are disabled are:</p>
<ul>
<li><code>field/marking/private</code></li>
<li><code>method/marking/private</code></li>
<li><code>method/marking/static</code></li>
<li><code>method/marking/final</code></li>
<li><code>method/inlining/short</code></li>
<li><code>method/inlining/unique</code></li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nb">-include </span><span class="err">/lib/dexguard-espresso-aggressive-optimizations.pro</span>
</code></pre></div>

<h3 id="dexguard-espresso-safe-optimizationspro"><code>dexguard-espresso-safe-optimizations.pro</code><a class="headerlink" href="#dexguard-espresso-safe-optimizationspro" title="Permanent link">&para;</a></h3>
<p>This is an extension of the
<a href="#dexguard-espresso-aggressive-optimizationspro"><code>dexguard-espresso-aggressive-optimizations.pro</code></a>
configuration and disables more optimizations. The optimizations in question
are responsible for most drastic changes in code structure and using this
configuration should allow you to access all of your application code from your
tests. The optimizations that are disabled <strong>in addition</strong> to the ones
mentioned above are:</p>
<ul>
<li><code>class/merging/vertical</code></li>
<li><code>class/merging/horizontal</code></li>
<li><code>class/merging/wrapper</code></li>
<li><code>field/generalization/class</code></li>
<li><code>method/generalization/class</code></li>
<li><code>field/sepcialization/type</code></li>
<li><code>method/sepcialization/parametertype</code></li>
<li><code>method/sepcialization/returntype</code></li>
<li><code>field/propagation/value</code></li>
<li><code>method/propagation/parameter</code></li>
<li><code>method/propagation/returnvalue</code></li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nb">-include </span><span class="err">/lib/dexguard-espresso-safe-optimizations.pro</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The configuration <code>dexguard-espresso-safe-optimizations.pro</code> is a superset
of <code>dexguard-espresso-aggressive-optimizations.pro</code>. This means you should
not include both at the same time. They can be combined with the other
default configurations, just not with each other.</p>
</div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="repository.html" title="Maven repository" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Maven repository
              </span>
            </div>
          </a>
        
        
          <a href="cordovaplugin.html" title="Cordova Plugin" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Cordova Plugin
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Guardsquare
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://twitter.com/guardsquare" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/guardsquare-nv" target="_blank" rel="noopener" title="linkedin" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://www.facebook.com/guardsquare" target="_blank" rel="noopener" title="facebook" class="md-footer-social__link fa fa-facebook"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>